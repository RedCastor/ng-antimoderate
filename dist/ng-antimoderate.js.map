{"version":3,"sources":["ng-antimoderate.js"],"names":["angular","module","directive","$timeout","$window","restrict","replace","scope","ngAntimoderate","loadSrc","loadDelay","errSrc","filter","transition","loadingClass","loadedClass","overflow","onSuccess","onError","transclude","link","$scope","el","attrs","img","param","temp_loaded_src","temp_image","image_load","micro_src","load_src","err_src","load_delay","parseInt","isDefined","loading_class","loaded_class","toMS","s","parseFloat","test","wrap","toWrap","wrapper","document","createElement","parentNode","appendChild","createImage","src","image","Image","destroyImage","addTransition","wrapper_img","classList","add","style","width","height","addStyleMicro","opacity","remove","applyStyleMicro","transitionDuration","addFilter","applyTransition","parentElement","applyClass","setImg","objectFitImages","isFunction","setOriginal","promise","original","onload","push","then","micro","onerror","err","processImage","img_el","load","length","micro_timeout","addClass","indexOf","$watch","new_val","old_val","window"],"mappings":"CAAA,SAAUA;IACN;IAEAA,QAAQC,OAAO,sBAAsBC,UAAU,oBAAoB,YAAY,WAAW,SAAUC,UAAUC;QAC1G;YACIC,UAAU;YACVC,SAAS;YACTC;gBACIC,gBAAgB;gBAChBC,SAAS;gBACTC,WAAW;gBACXC,QAAQ;gBACRC,QAAQ;gBACRC,YAAY;gBACZC,cAAc;gBACdC,aAAa;gBACbC,UAAU;gBACVC,WAAW;gBACXC,SAAS;;YAEbC,YAAY;YACZC,MAAM,SAASC,QAAQC,IAAIC;gBAEvB,IAAIC,MAAMF,GAAG;gBACb,IAAIG;gBACJ,IAAIC;gBACJ,IAAIC;gBACJ,IAAIC,aAAa;gBAEjBH,MAAMI,YAAYR,OAAOb,kBAAkB;gBAC3CiB,MAAMK,WAAWT,OAAOZ,WAAWmB;gBACnCH,MAAMM,UAAUV,OAAOV,UAAUiB;gBACjCH,MAAMO,aAAaC,SAASZ,OAAOX,cAAc;gBACjDe,MAAMb,SAASZ,QAAQkC,UAAUb,OAAOT,UAAUS,OAAOT,SAAS;gBAClEa,MAAMZ,aAAab,QAAQkC,UAAUb,OAAOR,cAAcQ,OAAOR,aAAa;gBAC9EY,MAAMU,gBAAgBnC,QAAQkC,UAAUb,OAAOP,gBAAgBO,OAAOP,eAAe;gBACrFW,MAAMW,eAAepC,QAAQkC,UAAUb,OAAON,eAAeM,OAAON,cAAc;gBAClFU,MAAMT,WAAWhB,QAAQkC,UAAUb,OAAOL,YAAYK,OAAOL,WAAW;gBAOxE,SAASqB,KAAKC;oBACV,OAAOC,WAAWD,MAAM,OAAOE,KAAKF,KAAI,MAAO;;gBAUnD,SAASG,KAAMC,QAAQC;oBACnBA,UAAUA,WAAWC,SAASC,cAAc;oBAC5CH,OAAOI,WAAWC,YAAYJ;oBAC9BA,QAAQI,YAAYL;oBAEpB,OAAOC;;gBAWX,SAASK,YAAcC;oBACnB,IAAIzB;wBACA0B,OAAO,IAAIC;wBACXF,KAAKA;;oBAGTzB,IAAI0B,MAAMD,MAAMA;oBAEhB,OAAOzB;;gBASX,SAAS4B,aAAeF;oBAEpBA,QAAQ;oBAER,OAAOA;;gBAKX,SAASG,cAAe7B,KAAKC;oBAEzB,IAAIA,MAAMZ,cAAcY,MAAMT,UAAU;wBACpC,IAAIsC,cAAcb,KAAKjB;wBACvB8B,YAAYC,UAAUC,IAAI;wBAC1BF,YAAYG,MAAMC,QAAQ;wBAC1BJ,YAAYG,MAAME,SAAS;wBAC3BL,YAAYG,MAAMzC,WAAW;;oBAGjC,OAAOQ;;gBAGX,SAASoC,cAAepC,KAAKC;oBAEzB,IAAIA,MAAMO,aAAa,GAAG;wBACtBR,IAAIiC,MAAMI,UAAU;wBACpBrC,IAAIiC,MAAM5C,aAAa,aAAaY,MAAMO,aAAa;;oBAG3DR,IAAI+B,UAAUO,OAAOrC,MAAMW;oBAC3BZ,IAAI+B,UAAUC,IAAI/B,MAAMU;oBAExB,OAAOX;;gBAGX,SAASuC,gBAAiBvC,KAAKC;oBAE3B,IAAIA,MAAMO,aAAa,GAAG;wBACtBR,IAAIiC,MAAM5C,aAAa,aAAaY,MAAMO,aAAa;wBACvDR,IAAIiC,MAAMI,UAAU;wBAEpB1D,SAAS;4BACLqB,IAAIiC,MAAMI,UAAU;2BACrBxB,KAAKb,IAAIiC,MAAMO;;oBAGtB,OAAOxC;;gBAGX,SAASyC,UAAWzC,KAAKC;oBAErB,IAAIA,MAAMb,QAAQ;wBACdY,IAAIiC,MAAM7C,SAASa,MAAMb;;oBAG7B,OAAOY;;gBAGX,SAAS0C,gBAAiB1C,KAAKC;oBAE3B,IAAIA,MAAMZ,YAAY;wBAClBW,IAAIiC,MAAM5C,aAAaY,MAAMZ;;oBAGjC,IAAIY,MAAMb,QAAQ;wBACdY,IAAIiC,MAAM7C,SAAS;;oBAGvBT,SAAS;wBAEL,IAAIsB,MAAMb,QAAQ;4BACdY,IAAIiC,MAAM7C,SAAS;;wBAGvB,IAAIa,MAAMZ,YAAY;4BAClB,IAAIY,MAAMT,UAAU;gCAChBQ,IAAI2C,cAAcV,MAAMzC,WAAW;;4BAGvCQ,IAAIiC,MAAM5C,aAAa;;uBAE5BwB,KAAKb,IAAIiC,MAAMO;oBAElB,OAAOxC;;gBAGX,SAAS4C,WAAY5C,KAAKC;oBAEtBD,IAAI+B,UAAUO,OAAOrC,MAAMU;oBAC3BX,IAAI+B,UAAUC,IAAI/B,MAAMW;oBAExB,OAAOZ;;gBAGX,SAAS6C,OAAQ7C,KAAKyB,KAAKxB;oBAEvBD,IAAIyB,MAAMA;oBAEV,IAAIjD,QAAQkC,UAAU9B,QAAQkE,oBAAoBtE,QAAQuE,WAAWnE,QAAQkE,kBAAkB;wBAC3FA,gBAAgB;;oBAGpB,OAAO9C;;gBAGX,SAASgD,YAAavB,KAAKxB,OAAOE,YAAY8C;oBAE1C9C,WAAW+C,WAAW1B,YAAaC;oBAEnCtB,WAAW+C,SAASxB,MAAMyB,SAAS;wBAE/BjD,gBAAgBkD,KAAKpD,IAAIyB;wBAGzBwB,QAAQI,KAAK;4BAGT1E,SAAS;gCACLkE,OAAO7C,KAAKG,WAAW+C,SAASzB,KAAKxB;gCACrC2B,aAAazB,WAAWmD;gCACxB1B,aAAazB,WAAW+C;gCAExBN,WAAW5C,KAAKC;gCAChByC,gBAAgB1C,KAAKC;gCAGrBJ,OAAOJ;+BACR;;;oBAIXU,WAAW+C,SAASxB,MAAM6B,UAAU;wBAEhCpD,WAAWqD,MAAMhC,YAAavB,MAAMM;wBAEpCJ,WAAWqD,IAAI9B,MAAMyB,SAAS;4BAG1BF,QAAQI,KAAK;gCAGT1E,SAAS;oCACLkE,OAAO7C,KAAKG,WAAWqD,IAAI/B,KAAKxB;oCAChC2B,aAAazB,WAAWmD;oCACxB1B,aAAazB,WAAW+C;oCACxBtB,aAAazB,WAAWqD;oCAExBZ,WAAW5C,KAAKC;oCAChByC,gBAAgB1C,KAAKC;oCAGrBJ,OAAOH;mCACR;;;;;gBAOnB,IAAI+D,eAAe,SAAUC,QAAQzD;oBAEjC,IAAID,MAAM0D,OAAO;oBAGjBvD,WAAWwD,OAAOnC,YAAavB,MAAMK;oBAErCH,WAAWwD,KAAKjC,MAAMyB,SAAS;wBAE3BtB,cAAc7B,KAAKC;wBAGnBA,MAAMI,YAAYJ,MAAMI,UAAUuD,SAAS3D,MAAMI,YAAYJ,MAAMK;wBACnEH,WAAWmD,QAAQ9B,YAAavB,MAAMI;wBAEtCF,WAAWmD,MAAM5B,MAAMyB,SAAS;4BAE5Bf,cAAcpC,KAAKC;4BAGnB,IAAI4D,gBAAgBlF,SAAS;gCACzBkE,OAAO7C,KAAKG,WAAWmD,MAAM7B,KAAKxB;gCAClC2B,aAAazB,WAAWwD;gCAExBpB,gBAAgBvC,KAAKC;gCACrBwC,UAAUzC,KAAKC;+BAChBA,MAAMO,aAAa,IAAIP,MAAMO,aAAa,IAAI;4BAEjDwC,YAAYjD,MAAM0B,KAAKxB,OAAOE,YAAY0D;;wBAG9C1D,WAAWmD,MAAM5B,MAAM6B,UAAU;4BAC7BnB,cAAcpC,KAAKC;4BAEnB,IAAI4D,gBAAgBlF,SAAS;gCACzBiD,aAAazB,WAAWwD;gCAExBpB,gBAAgBvC,KAAKC;gCACrBwC,UAAUzC,KAAKC;+BAChB;4BAEH+C,YAAYjD,MAAM0B,KAAKxB,OAAOE,YAAY0D;;wBAI9ClF,SAAS;4BACLkE,OAAO7C,KAAKG,WAAWwD,KAAKlC,KAAKxB;2BAClC;;;gBAIXH,GAAGgE,SAAS;gBAEZ,IAAI5D,gBAAgB6D,QAAQ/D,IAAIyB,UAAU,GAAG;oBACzCgC,aAAa3D,IAAIG;;gBAGrBJ,OAAOmE,OAAO,kBAAkB,SAASC,SAASC;oBAC9C,IAAID,YAAYC,WAAWhE,gBAAgB6D,QAAQ/D,IAAIyB,UAAU,GAAG;wBAChExB,MAAMI,YAAY4D;wBAClBR,aAAa3D,IAAIG;;;;;;EAnTzC,CA0TGkE,OAAO3F","file":"ng-antimoderate.js","sourcesContent":["(function(angular){\n    'use strict';\n\n    angular.module('ngAntimoderate', []).directive('ngAntimoderate', [ '$timeout', '$window', function ($timeout, $window) {\n        return {\n            restrict: \"A\",\n            replace: false,\n            scope: {\n                ngAntimoderate: \"@\",\n                loadSrc: \"@\",\n                loadDelay: \"@\",\n                errSrc: \"@\",\n                filter: \"@\",\n                transition: \"@\",\n                loadingClass: \"@\",\n                loadedClass: \"@\",\n                overflow: \"@\",\n                onSuccess: \"&\",\n                onError: \"&\"\n            },\n            transclude: false,\n            link: function($scope, el, attrs) {\n\n                var img = el[0];\n                var param = {};\n                var temp_loaded_src = [];\n                var temp_image = {};\n                var image_load = \"data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==\";\n\n                param.micro_src = $scope.ngAntimoderate || \"\";\n                param.load_src = $scope.loadSrc || image_load;\n                param.err_src = $scope.errSrc || image_load;\n                param.load_delay = parseInt($scope.loadDelay) || 300; //0 for disable, value ms\n                param.filter = angular.isDefined($scope.filter) ? $scope.filter : \"blur(20px)\";\n                param.transition = angular.isDefined($scope.transition) ? $scope.transition : \"filter 300ms\";\n                param.loading_class = angular.isDefined($scope.loadingClass) ? $scope.loadingClass : \"loading\";\n                param.loaded_class = angular.isDefined($scope.loadedClass) ? $scope.loadedClass : \"loaded\";\n                param.overflow = angular.isDefined($scope.overflow) ? $scope.overflow : true;\n\n                /**\n                 * Convert css timing to milisecond number\n                 * @param s\n                 * @returns {number}\n                 */\n                function toMS(s) {\n                    return parseFloat(s) * (/\\ds$/.test(s)? 1000 : 1);\n                }\n\n                /**\n                 * Wrap Element\n                 *\n                 * @param toWrap\n                 * @param wrapper\n                 * @returns {Node}\n                 */\n                function wrap (toWrap, wrapper) {\n                    wrapper = wrapper || document.createElement('div');\n                    toWrap.parentNode.appendChild(wrapper);\n                    wrapper.appendChild(toWrap);\n\n                    return wrapper;\n                }\n\n                /**\n                 * Create a image\n                 *\n                 * @param temp\n                 * @param src_name\n                 * @param src\n                 * @constructor\n                 */\n                function createImage ( src ) {\n                    var img = {\n                        image: new Image(),\n                        src: src\n                    };\n\n                    img.image.src = src;\n\n                    return img;\n                }\n\n                /**\n                 * Destroy a image\n                 *\n                 * @param temp\n                 * @param src_name\n                 */\n                function destroyImage ( image ) {\n\n                    image = null;\n\n                    return image;\n                }\n\n\n\n                function addTransition (img, param) {\n\n                    if (param.transition && param.overflow) {\n                        var wrapper_img = wrap(img);\n                        wrapper_img.classList.add('antimoderate-overflow');\n                        wrapper_img.style.width = '100%';\n                        wrapper_img.style.height = '100%';\n                        wrapper_img.style.overflow = \"hidden\";\n                    }\n\n                    return img;\n                }\n\n                function addStyleMicro (img, param) {\n\n                    if (param.load_delay > 0) {\n                        img.style.opacity = 0;\n                        img.style.transition = \"opacity \" + param.load_delay + 'ms';\n                    }\n\n                    img.classList.remove(param.loaded_class);\n                    img.classList.add(param.loading_class);\n\n                    return img;\n                }\n\n                function applyStyleMicro (img, param) {\n\n                    if (param.load_delay > 0) {\n                        img.style.transition = \"opacity \" + param.load_delay + 'ms';\n                        img.style.opacity = 1;\n\n                        $timeout(function () {\n                            img.style.opacity = '';\n                        }, toMS(img.style.transitionDuration) );\n                    }\n\n                    return img;\n                }\n\n                function addFilter (img, param) {\n\n                    if (param.filter) {\n                        img.style.filter = param.filter;\n                    }\n\n                    return img;\n                }\n\n                function applyTransition (img, param) {\n\n                    if (param.transition) {\n                        img.style.transition = param.transition;\n                    }\n\n                    if (param.filter) {\n                        img.style.filter = \"none \";\n                    }\n\n                    $timeout(function () {\n\n                        if (param.filter) {\n                            img.style.filter = \"\";\n                        }\n\n                        if (param.transition) {\n                            if (param.overflow) {\n                                img.parentElement.style.overflow = \"\";\n                            }\n\n                            img.style.transition = \"\";\n                        }\n                    }, toMS(img.style.transitionDuration) );\n\n                    return img;\n                }\n\n                function applyClass (img, param) {\n\n                    img.classList.remove(param.loading_class);\n                    img.classList.add(param.loaded_class);\n\n                    return img;\n                }\n\n                function setImg (img, src, param) {\n\n                    img.src = src;\n\n                    if (angular.isDefined($window.objectFitImages) && angular.isFunction($window.objectFitImages)) {\n                        objectFitImages('img.antimoderate');\n                    }\n\n                    return img;\n                }\n\n                function setOriginal( src, param, temp_image, promise) {\n                    //Create Original image\n                    temp_image.original = createImage( src );\n\n                    temp_image.original.image.onload = function() {\n\n                        temp_loaded_src.push(img.src);\n\n                        //Replace by original after promise micro\n                        promise.then(function () {\n\n                            //Add Timeout for workaround on IE\n                            $timeout(function () {\n                                setImg(img, temp_image.original.src, param);\n                                destroyImage(temp_image.micro);\n                                destroyImage(temp_image.original);\n\n                                applyClass(img, param);\n                                applyTransition(img, param);\n\n                                //Directive Result Success\n                                $scope.onSuccess();\n                            }, 0);\n                        });\n                    };\n\n                    temp_image.original.image.onerror = function() {\n\n                        temp_image.err = createImage( param.err_src );\n\n                        temp_image.err.image.onload = function() {\n\n                            //Replace by original after timeout micro\n                            promise.then(function () {\n\n                                //Add Timeout for workaround on IE\n                                $timeout(function () {\n                                    setImg(img, temp_image.err.src, param);\n                                    destroyImage(temp_image.micro);\n                                    destroyImage(temp_image.original);\n                                    destroyImage(temp_image.err);\n\n                                    applyClass(img, param);\n                                    applyTransition(img, param);\n\n                                    //Directive Result Error\n                                    $scope.onError();\n                                }, 0);\n                            });\n                        };\n                    };\n                }\n\n\n                var processImage = function (img_el, param) {\n\n                    var img = img_el[0];\n\n                    //Create micro image\n                    temp_image.load = createImage( param.load_src );\n\n                    temp_image.load.image.onload = function() {\n\n                        addTransition(img, param);\n\n                        //Create micro image\n                        param.micro_src = param.micro_src.length ? param.micro_src : param.load_src;\n                        temp_image.micro = createImage( param.micro_src );\n\n                        temp_image.micro.image.onload = function() {\n\n                            addStyleMicro(img, param);\n\n                            //Add Timeout animation load source to micro source\n                            var micro_timeout = $timeout(function () {\n                                setImg(img, temp_image.micro.src, param);\n                                destroyImage(temp_image.load);\n\n                                applyStyleMicro(img, param);\n                                addFilter(img, param);\n                            }, param.load_delay > 0 ? param.load_delay / 2 : 0 );\n\n                            setOriginal(attrs.src, param, temp_image, micro_timeout);\n                        };\n\n                        temp_image.micro.image.onerror = function() {\n                            addStyleMicro(img, param);\n\n                            var micro_timeout = $timeout(function () {\n                                destroyImage(temp_image.load);\n\n                                applyStyleMicro(img, param);\n                                addFilter(img, param);\n                            }, 0);\n\n                            setOriginal(attrs.src, param, temp_image, micro_timeout);\n                        };\n\n                        //Add Timeout for workaround on IE\n                        $timeout(function () {\n                            setImg(img, temp_image.load.src, param);\n                        }, 0);\n                    };\n                };\n\n                el.addClass(\"antimoderate\");\n\n                if (temp_loaded_src.indexOf(img.src) === -1) {\n                    processImage(el, param);\n                }\n\n                $scope.$watch(\"ngAntimoderate\", function(new_val, old_val) {\n                    if (new_val !== old_val && temp_loaded_src.indexOf(img.src) === -1) {\n                        param.micro_src = new_val;\n                        processImage(el, param);\n                    }\n                });\n            }\n        };\n    }]);\n\n})(window.angular);\n"],"sourceRoot":"dist"}