{"version":3,"sources":["ng-antimoderate.js"],"names":["angular","module","directive","$timeout","restrict","replace","scope","ngAntimoderate","loadSrc","loadTransitionDelay","filter","transition","loadingClass","loadedClass","overflow","transclude","link","$scope","el","attrs","img","param","temp_loaded_src","temp_image","micro_src","load_src","load_delay","parseInt","loadDelay","isDefined","loading_class","loaded_class","toMS","s","parseFloat","test","wrap","toWrap","wrapper","document","createElement","parentNode","appendChild","createImage","src","image","Image","destroyImage","addTransition","parentElement","nodeName","wrapper_img","classList","add","style","width","height","addStyleMicro","opacity","remove","applyStyleMicro","transitionDuration","addFilter","applyTransition","setImg","objectFitImages","isFunction","processImage","img_el","load","onload","length","micro","micro_timeout","original","push","then","removeClass","addClass","onerror","indexOf","$watch","new_val","old_val","window"],"mappings":"CAAA,SAAUA;IACN;IAEAA,QAAQC,OAAO,sBAAsBC,UAAU,oBAAoB,YAAY,SAAUC;QACrF;YACIC,UAAU;YACVC,SAAS;YACTC;gBACIC,gBAAgB;gBAChBC,SAAS;gBACTC,qBAAqB;gBACrBC,QAAQ;gBACRC,YAAY;gBACZC,cAAc;gBACdC,aAAa;gBACbC,UAAU;;YAEdC,YAAY;YACZC,MAAM,SAASC,QAAQC,IAAIC;gBAEvB,IAAIC,MAAMF,GAAG;gBACb,IAAIG;gBACJ,IAAIC;gBACJ,IAAIC;gBAEJF,MAAMG,YAAYP,OAAOV,kBAAkB;gBAC3Cc,MAAMI,WAAWR,OAAOT,WAAW;gBACnCa,MAAMK,aAAaC,SAASV,OAAOW,cAAc;gBACjDP,MAAMX,SAASV,QAAQ6B,UAAUZ,OAAOP,UAAUO,OAAOP,SAAS;gBAClEW,MAAMV,aAAaX,QAAQ6B,UAAUZ,OAAON,cAAcM,OAAON,aAAa;gBAC9EU,MAAMS,gBAAgB9B,QAAQ6B,UAAUZ,OAAOL,gBAAgBK,OAAOL,eAAe;gBACrFS,MAAMU,eAAe/B,QAAQ6B,UAAUZ,OAAOJ,eAAeI,OAAOJ,cAAc;gBAClFQ,MAAMP,WAAWd,QAAQ6B,UAAUZ,OAAOH,YAAYG,OAAOH,WAAW;gBAOxE,SAASkB,KAAKC;oBACV,OAAOC,WAAWD,MAAM,OAAOE,KAAKF,KAAI,MAAO;;gBAUnD,SAASG,KAAMC,QAAQC;oBACnBA,UAAUA,WAAWC,SAASC,cAAc;oBAC5CH,OAAOI,WAAWC,YAAYJ;oBAE9B,OAAOA,QAAQI,YAAYL;;gBAW/B,SAASM,YAAcC;oBACnB,IAAIxB;wBACAyB,OAAO,IAAIC;wBACXF,KAAKA;;oBAGTxB,IAAIyB,MAAMD,MAAMA;oBAEhB,OAAOxB;;gBASX,SAAS2B,aAAeF;oBAEpBA,QAAQ;oBAER,OAAOA;;gBAKX,SAASG,cAAe5B,KAAKC;oBAEzB,IAAIA,MAAMV,cAAcU,MAAMP,UAAU;wBACpC,IAAIM,IAAI6B,cAAcC,aAAa,OAAO;4BACtC,IAAIC,cAAcf,KAAKhB;4BACvB+B,YAAYC,UAAUC,IAAI;4BAC1BF,YAAYG,MAAMC,QAAQ;4BAC1BJ,YAAYG,MAAME,SAAS;;wBAG/BpC,IAAI6B,cAAcK,MAAMxC,WAAW;;oBAGvC,OAAOM;;gBAGX,SAASqC,cAAerC,KAAKC;oBAEzB,IAAIA,MAAMK,aAAa,GAAG;wBACtBN,IAAIkC,MAAMI,UAAU;wBACpBtC,IAAIkC,MAAM3C,aAAa,aAAaU,MAAMK,aAAa;;oBAG3DN,IAAIgC,UAAUO,OAAOtC,MAAMU;oBAC3BX,IAAIgC,UAAUC,IAAIhC,MAAMS;oBAExB,OAAOV;;gBAGX,SAASwC,gBAAiBxC,KAAKC;oBAE3B,IAAIA,MAAMK,aAAa,GAAG;wBACtBN,IAAIkC,MAAM3C,aAAa,aAAaU,MAAMK,aAAa;wBACvDN,IAAIkC,MAAMI,UAAU;wBAEpBvD,SAAS;4BACLiB,IAAIkC,MAAMI,UAAU;2BACrB1B,KAAKZ,IAAIkC,MAAMO;;oBAGtB,OAAOzC;;gBAGX,SAAS0C,UAAW1C,KAAKC;oBAErB,IAAIA,MAAMX,QAAQ;wBACdU,IAAIkC,MAAM5C,SAASW,MAAMX;;oBAG7B,OAAOU;;gBAGX,SAAS2C,gBAAiB3C,KAAKC;oBAE3B,IAAIA,MAAMV,YAAY;wBAClBS,IAAIkC,MAAM3C,aAAaU,MAAMV;;oBAGjC,IAAIU,MAAMX,QAAQ;wBACdU,IAAIkC,MAAM5C,SAAS;;oBAGvBP,SAAS;wBAEL,IAAIkB,MAAMX,QAAQ;4BACdU,IAAIkC,MAAM5C,SAAS;;wBAGvB,IAAIW,MAAMV,YAAY;4BAClB,IAAIU,MAAMP,UAAU;gCAChBM,IAAI6B,cAAcK,MAAMxC,WAAW;;4BAGvCM,IAAIkC,MAAM3C,aAAa;;uBAE5BqB,KAAKZ,IAAIkC,MAAMO;oBAElB,OAAOzC;;gBAGX,SAAS4C,OAAQ5C,KAAKwB,KAAKvB;oBAEvBD,IAAIwB,MAAMA;oBAEV,IAAI5C,QAAQ6B,UAAUoC,oBAAoBjE,QAAQkE,WAAWD,kBAAkB;wBAC3EA,gBAAgB;;oBAGpB,OAAO7C;;gBAKX,IAAI+C,eAAe,SAAUC,QAAQ/C;oBAEjC,IAAID,MAAMgD,OAAO;oBAGjB7C,WAAW8C,OAAO1B,YAAatB,MAAMI;oBAErCF,WAAW8C,KAAKxB,MAAMyB,SAAS;wBAE3BtB,cAAc5B,KAAKC;wBAGnBA,MAAMG,YAAYH,MAAMG,UAAU+C,SAASlD,MAAMG,YAAYH,MAAMI;wBACnEF,WAAWiD,QAAQ7B,YAAatB,MAAMG;wBAEtCD,WAAWiD,MAAM3B,MAAMyB,SAAS;4BAE5Bb,cAAcrC,KAAKC;4BAGnB,IAAIoD,gBAAgBtE,SAAS;gCACzB6D,OAAO5C,KAAKG,WAAWiD,MAAM5B,KAAKvB;gCAClC0B,aAAaxB,WAAW8C;gCAExBT,gBAAgBxC,KAAKC;gCACrByC,UAAU1C,KAAKC;+BAChBA,MAAMK,aAAa,IAAIL,MAAMK,aAAa,IAAI;4BAGjDH,WAAWmD,WAAW/B,YAAaxB,MAAMyB;4BAEzCrB,WAAWmD,SAAS7B,MAAMyB,SAAS;gCAE/BhD,gBAAgBqD,KAAKvD,IAAIwB;gCAGzB6B,cAAcG,KAAK;oCAEfR,OAAOS,YAAYxD,MAAMS;oCACzBsC,OAAOU,SAASzD,MAAMU;oCAGtB5B,SAAS;wCACL6D,OAAO5C,KAAKG,WAAWmD,SAAS9B,KAAKvB;wCACrC0B,aAAaxB,WAAWiD;wCACxBzB,aAAaxB,WAAWmD;wCAExBX,gBAAgB3C,KAAKC;uCACtB;;;4BAIXE,WAAWmD,SAAS7B,MAAMkC,UAAU;gCAEhChB,gBAAgB3C,KAAKC;;;wBAI7BE,WAAWiD,MAAM3B,MAAMkC,UAAU;4BAE7BnB,gBAAgBxC,KAAKC;;wBAIzBlB,SAAS;4BACL6D,OAAO5C,KAAKG,WAAW8C,KAAKzB,KAAKvB;2BAClC;;;gBAIXH,GAAG4D,SAAS;gBAEZ,IAAIxD,gBAAgB0D,QAAQ5D,IAAIwB,UAAU,GAAG;oBACzCuB,aAAajD,IAAIG;;gBAGrBJ,OAAOgE,OAAO,kBAAkB,SAASC,SAASC;oBAC9C,IAAID,YAAYC,WAAW7D,gBAAgB0D,QAAQ5D,IAAIwB,UAAU,GAAG;wBAChEvB,MAAMG,YAAY0D;wBAClBf,aAAajD,IAAIG;;;;;;EAvQzC,CA8QG+D,OAAOpF","file":"ng-antimoderate.js","sourcesContent":["(function(angular){\n    'use strict';\n\n    angular.module('ngAntimoderate', []).directive('ngAntimoderate', [ '$timeout', function ($timeout) {\n        return {\n            restrict: \"A\",\n            replace: false,\n            scope: {\n                ngAntimoderate: \"@\",\n                loadSrc: \"@\",\n                loadTransitionDelay: \"@\",\n                filter: \"@\",\n                transition: \"@\",\n                loadingClass: \"@\",\n                loadedClass: \"@\",\n                overflow: \"@\"\n            },\n            transclude: false,\n            link: function($scope, el, attrs) {\n\n                var img = el[0];\n                var param = {};\n                var temp_loaded_src = [];\n                var temp_image = {};\n\n                param.micro_src = $scope.ngAntimoderate || \"\";\n                param.load_src = $scope.loadSrc || \"data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==\";\n                param.load_delay = parseInt($scope.loadDelay) || 300; //0 for disable, value ms\n                param.filter = angular.isDefined($scope.filter) ? $scope.filter : \"blur(20px)\";\n                param.transition = angular.isDefined($scope.transition) ? $scope.transition : \"filter 300ms\";\n                param.loading_class = angular.isDefined($scope.loadingClass) ? $scope.loadingClass : \"loading\";\n                param.loaded_class = angular.isDefined($scope.loadedClass) ? $scope.loadedClass : \"loaded\";\n                param.overflow = angular.isDefined($scope.overflow) ? $scope.overflow : true;\n\n                /**\n                 * Convert css timing to milisecond number\n                 * @param s\n                 * @returns {number}\n                 */\n                function toMS(s) {\n                    return parseFloat(s) * (/\\ds$/.test(s)? 1000 : 1);\n                }\n\n                /**\n                 * Wrap Element\n                 *\n                 * @param toWrap\n                 * @param wrapper\n                 * @returns {Node}\n                 */\n                function wrap (toWrap, wrapper) {\n                    wrapper = wrapper || document.createElement('div');\n                    toWrap.parentNode.appendChild(wrapper);\n\n                    return wrapper.appendChild(toWrap);\n                }\n\n                /**\n                 * Create a image\n                 *\n                 * @param temp\n                 * @param src_name\n                 * @param src\n                 * @constructor\n                 */\n                function createImage ( src ) {\n                    var img = {\n                        image: new Image(),\n                        src: src\n                    };\n\n                    img.image.src = src;\n\n                    return img;\n                }\n\n                /**\n                 * Destroy a image\n                 *\n                 * @param temp\n                 * @param src_name\n                 */\n                function destroyImage ( image ) {\n\n                    image = null;\n\n                    return image;\n                }\n\n\n\n                function addTransition (img, param) {\n\n                    if (param.transition && param.overflow) {\n                        if (img.parentElement.nodeName !== 'DIV') {\n                            var wrapper_img = wrap(img);\n                            wrapper_img.classList.add('antimoderate-overflow');\n                            wrapper_img.style.width = '100%';\n                            wrapper_img.style.height = '100%';\n                        }\n\n                        img.parentElement.style.overflow = \"hidden\";\n                    }\n\n                    return img;\n                }\n\n                function addStyleMicro (img, param) {\n\n                    if (param.load_delay > 0) {\n                        img.style.opacity = 0;\n                        img.style.transition = \"opacity \" + param.load_delay + 'ms';\n                    }\n\n                    img.classList.remove(param.loaded_class);\n                    img.classList.add(param.loading_class);\n\n                    return img;\n                }\n\n                function applyStyleMicro (img, param) {\n\n                    if (param.load_delay > 0) {\n                        img.style.transition = \"opacity \" + param.load_delay + 'ms';\n                        img.style.opacity = 1;\n\n                        $timeout(function () {\n                            img.style.opacity = '';\n                        }, toMS(img.style.transitionDuration) );\n                    }\n\n                    return img;\n                }\n\n                function addFilter (img, param) {\n\n                    if (param.filter) {\n                        img.style.filter = param.filter;\n                    }\n\n                    return img;\n                }\n\n                function applyTransition (img, param) {\n\n                    if (param.transition) {\n                        img.style.transition = param.transition;\n                    }\n\n                    if (param.filter) {\n                        img.style.filter = \"none \";\n                    }\n\n                    $timeout(function () {\n\n                        if (param.filter) {\n                            img.style.filter = \"\";\n                        }\n\n                        if (param.transition) {\n                            if (param.overflow) {\n                                img.parentElement.style.overflow = \"\";\n                            }\n\n                            img.style.transition = \"\";\n                        }\n                    }, toMS(img.style.transitionDuration) );\n\n                    return img;\n                }\n\n                function setImg (img, src, param) {\n\n                    img.src = src;\n\n                    if (angular.isDefined(objectFitImages) && angular.isFunction(objectFitImages)) {\n                        objectFitImages('img.antimoderate');\n                    }\n\n                    return img;\n                }\n\n\n\n                var processImage = function (img_el, param) {\n\n                    var img = img_el[0];\n\n                    //Create micro image\n                    temp_image.load = createImage( param.load_src );\n\n                    temp_image.load.image.onload = function() {\n\n                        addTransition(img, param);\n\n                        //Create micro image\n                        param.micro_src = param.micro_src.length ? param.micro_src : param.load_src;\n                        temp_image.micro = createImage( param.micro_src );\n\n                        temp_image.micro.image.onload = function() {\n\n                            addStyleMicro(img, param);\n\n                            //Add Timeout animation load source to micro source\n                            var micro_timeout = $timeout(function () {\n                                setImg(img, temp_image.micro.src, param);\n                                destroyImage(temp_image.load);\n\n                                applyStyleMicro(img, param);\n                                addFilter(img, param);\n                            }, param.load_delay > 0 ? param.load_delay / 2 : 0 );\n\n                            //Create Original image\n                            temp_image.original = createImage( attrs.src );\n\n                            temp_image.original.image.onload = function() {\n\n                                temp_loaded_src.push(img.src);\n\n                                //Replace by original after timeout micro\n                                micro_timeout.then(function () {\n\n                                    img_el.removeClass(param.loading_class);\n                                    img_el.addClass(param.loaded_class);\n\n                                    //Add Timeout for workaround on IE\n                                    $timeout(function () {\n                                        setImg(img, temp_image.original.src, param);\n                                        destroyImage(temp_image.micro);\n                                        destroyImage(temp_image.original);\n\n                                        applyTransition(img, param);\n                                    }, 0);\n                                });\n                            };\n\n                            temp_image.original.image.onerror = function() {\n\n                                applyTransition(img, param);\n                            };\n                        };\n\n                        temp_image.micro.image.onerror = function() {\n\n                            applyStyleMicro(img, param);\n                        };\n\n                        //Add Timeout for workaround on IE\n                        $timeout(function () {\n                            setImg(img, temp_image.load.src, param);\n                        }, 0);\n                    };\n                };\n\n                el.addClass(\"antimoderate\");\n\n                if (temp_loaded_src.indexOf(img.src) === -1) {\n                    processImage(el, param);\n                }\n\n                $scope.$watch(\"ngAntimoderate\", function(new_val, old_val) {\n                    if (new_val !== old_val && temp_loaded_src.indexOf(img.src) === -1) {\n                        param.micro_src = new_val;\n                        processImage(el, param);\n                    }\n                });\n            }\n        };\n    }]);\n\n})(window.angular);\n"],"sourceRoot":"dist"}