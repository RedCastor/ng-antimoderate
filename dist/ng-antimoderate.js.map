{"version":3,"sources":["ng-antimoderate.js"],"names":["angular","module","provider","$ngAntimoderateProvider","default_src","load","error","undefined","this","src","$get","getSrc","setSrc","directive","$timeout","$window","$ngAntimoderate","restrict","scope","ngAntimoderate","loadSrc","loadDelay","errSrc","filter","transition","loadingClass","loadedClass","overflow","onSuccess","onError","transclude","link","$scope","el","attrs","img","img_display","style","display","param","temp_loaded_src","temp_image","image_load","image_err","micro_src","load_src","err_src","load_delay","parseInt","isDefined","loading_class","loaded_class","toMS","s","parseFloat","test","wrap","toWrap","wrapper","document","createElement","parentNode","insertBefore","nextSibling","appendChild","createImage","image","Image","destroyImage","addTransition","wrapper_img","classList","add","width","height","addStyleMicro","opacity","remove","applyStyleMicro","transitionDuration","addFilter","applyTransition","parentElement","applyClass","setImg","objectFitImages","isFunction","setImgErr","srcset","setOriginal","promise","original","onload","push","then","micro","onerror","err","processImage","img_el","complete","naturalWidth","getAttribute","clientWidth","clientHeight","length","micro_timeout","addClass","indexOf","$watch","new_val","old_val","window"],"mappings":"CAAA,SAAUA;IACN;IAGA,IAAIC,SAASD,QAAQC,OAAO,kBAAkB;IAE9CA,OAAOC,SAAS,mBAAmB,EAAE,SAASC;QAE1C,IAAIC,cAAc;YACdC,MAAM;YACNC,OAAOC;;QAGXC,KAAKC,MAAML;QAEXI,KAAKE,OAAO,EAAE;YACV,IAAID,MAAMD,KAAKC;YAEf,OAAO;gBACHE,QAAQ;oBACJ,OAAOF;;;;QAKnBD,KAAKI,SAAS,SAASH;YACnBD,KAAKC,IAAIJ,OAAOI,IAAIJ,QAAQD,YAAYC;YACxCG,KAAKC,IAAIH,QAAQG,IAAIH,SAASF,YAAYE;;;IAKlDL,OAAOY,UAAU,kBAAkB,EAAE,YAAY,WAAW,mBAAmB,SAAUC,UAAUC,SAASC;QAExG,OAAO;YACHC,UAAU;YACVC,OAAO;gBACHC,gBAAgB;gBAChBC,SAAS;gBACTC,WAAW;gBACXC,QAAQ;gBACRC,QAAQ;gBACRC,YAAY;gBACZC,cAAc;gBACdC,aAAa;gBACbC,UAAU;gBACVC,WAAW;gBACXC,SAAS;;YAEbC,YAAY;YACZC,MAAM,SAASC,QAAQC,IAAIC;gBAEvB,IAAIzB,MAAMO,gBAAgBL;gBAE1B,IAAIwB,MAAMF,GAAG;gBACb,IAAIG,cAAcD,IAAIE,MAAMC;gBAC5B,IAAIC,QAAQ;gBACZ,IAAIC,kBAAkB;gBACtB,IAAIC,aAAa;gBACjB,IAAIC,aAAajC,IAAIJ;gBACrB,IAAIsC,YAAYlC,IAAIH;gBAEpBiC,MAAMK,YAAYZ,OAAOb,kBAAkB;gBAC3CoB,MAAMM,WAAWb,OAAOZ,WAAWsB;gBACnCH,MAAMO,UAAUd,OAAOV,UAAUqB,aAAaD;gBAC9CH,MAAMQ,aAAaC,SAAShB,OAAOX,cAAc;gBACjDkB,MAAMhB,SAASvB,QAAQiD,UAAUjB,OAAOT,UAAUS,OAAOT,SAAS;gBAClEgB,MAAMf,aAAaxB,QAAQiD,UAAUjB,OAAOR,cAAcQ,OAAOR,aAAa;gBAC9Ee,MAAMW,gBAAgBlD,QAAQiD,UAAUjB,OAAOP,gBAAgBO,OAAOP,eAAe;gBACrFc,MAAMY,eAAenD,QAAQiD,UAAUjB,OAAON,eAAeM,OAAON,cAAc;gBAClFa,MAAMZ,WAAW3B,QAAQiD,UAAUjB,OAAOL,YAAYK,OAAOL,WAAW;gBASxE,SAASyB,KAAKC;oBACV,OAAOC,WAAWD,MAAM,OAAOE,KAAKF,KAAI,MAAO;;gBAUnD,SAASG,KAAMC,QAAQC;oBAEnBA,UAAUA,WAAWC,SAASC,cAAc;oBAC5CH,OAAOI,WAAWC,aAAaJ,SAASD,OAAOM;oBAC/CL,QAAQM,YAAYP;oBAEpB,OAAOC;;gBAWX,SAASO,YAAcxD;oBACnB,IAAI0B,MAAM;wBACN+B,OAAO,IAAIC;wBACX1D,KAAKA;;oBAGT0B,IAAI+B,MAAMzD,MAAMA;oBAEhB,OAAO0B;;gBASX,SAASiC,aAAeF;oBAEpBA,QAAQ;oBAER,OAAOA;;gBAKX,SAASG,cAAelC,KAAKI;oBAEzB,IAAIA,MAAMf,cAAce,MAAMZ,UAAU;wBACpC,IAAI2C,cAAcd,KAAKrB;wBACvBmC,YAAYC,UAAUC,IAAI;wBAC1BF,YAAYjC,MAAMoC,QAAQ;wBAC1BH,YAAYjC,MAAMqC,SAAS;wBAC3BJ,YAAYjC,MAAMV,WAAW;;oBAGjC,OAAOQ;;gBAGX,SAASwC,cAAexC,KAAKI;oBAEzB,IAAIA,MAAMQ,aAAa,GAAG;wBACtBZ,IAAIE,MAAMuC,UAAU;wBACpBzC,IAAIE,MAAMb,aAAa,aAAae,MAAMQ,aAAa;;oBAG3DZ,IAAIoC,UAAUM,OAAOtC,MAAMY;oBAC3BhB,IAAIoC,UAAUC,IAAIjC,MAAMW;oBAExB,OAAOf;;gBAGX,SAAS2C,gBAAiB3C,KAAKI;oBAE3B,IAAIA,MAAMQ,aAAa,GAAG;wBACtBZ,IAAIE,MAAMb,aAAa,aAAae,MAAMQ,aAAa;wBACvDZ,IAAIE,MAAMuC,UAAU;wBAEpB9D,SAAS;4BACLqB,IAAIE,MAAMuC,UAAU;2BACrBxB,KAAKjB,IAAIE,MAAM0C;;oBAGtB,OAAO5C;;gBAGX,SAAS6C,UAAW7C,KAAKI;oBAErB,IAAIA,MAAMhB,QAAQ;wBACdY,IAAIE,MAAMd,SAASgB,MAAMhB;;oBAG7B,OAAOY;;gBAGX,SAAS8C,gBAAiB9C,KAAKI;oBAE3B,IAAIA,MAAMf,YAAY;wBAClBW,IAAIE,MAAMb,aAAae,MAAMf;;oBAGjC,IAAIe,MAAMhB,QAAQ;wBACdY,IAAIE,MAAMd,SAAS;;oBAGvBT,SAAS;wBAEL,IAAIyB,MAAMhB,QAAQ;4BACdY,IAAIE,MAAMd,SAAS;;wBAGvB,IAAIgB,MAAMf,YAAY;4BAClB,IAAIe,MAAMZ,UAAU;gCAChBQ,IAAI+C,cAAc7C,MAAMV,WAAW;;4BAGvCQ,IAAIE,MAAMb,aAAa;;uBAE5B4B,KAAKjB,IAAIE,MAAM0C;oBAElB,OAAO5C;;gBAGX,SAASgD,WAAYhD,KAAKI;oBAEtBJ,IAAIoC,UAAUM,OAAOtC,MAAMW;oBAC3Bf,IAAIoC,UAAUC,IAAIjC,MAAMY;oBAExB,OAAOhB;;gBAGX,SAASiD,OAAQjD,KAAK1B,KAAK8B;oBAEvBJ,IAAI1B,MAAMA;oBAEV,IAAIT,QAAQiD,UAAUlC,QAAQsE,oBAAoBrF,QAAQsF,WAAWvE,QAAQsE,kBAAkB;wBAC3FA,gBAAgB;;oBAGpB,OAAOlD;;gBAIX,SAASoD,UAAWpD,KAAK1B,KAAK8B;oBAE1BJ,IAAIqD,SAAS/E;oBAEb,OAAO2E,OAAOjD,KAAK1B,KAAK8B;;gBAG5B,SAASkD,YAAahF,KAAK8B,OAAOE,YAAYiD;oBAE1CjD,WAAWkD,WAAW1B,YAAaxD;oBAEnCgC,WAAWkD,SAASzB,MAAM0B,SAAS;wBAE/BpD,gBAAgBqD,KAAK1D,IAAI1B;wBAGzBiF,QAAQI,KAAK;4BAEThF,SAAS;gCACLsE,OAAOjD,KAAKM,WAAWkD,SAASlF,KAAK8B;gCACrC6B,aAAa3B,WAAWsD;gCACxB3B,aAAa3B,WAAWkD;gCAExBR,WAAWhD,KAAKI;gCAChB0C,gBAAgB9C,KAAKI;gCAGrBP,OAAOJ;+BACR;;;oBAIXa,WAAWkD,SAASzB,MAAM8B,UAAU;wBAEhCvD,WAAWwD,MAAMhC,YAAa1B,MAAMO;wBAEpCL,WAAWwD,IAAI/B,MAAM0B,SAAS;4BAG1BF,QAAQI,KAAK;gCAEThF,SAAS;oCACLyE,UAAUpD,KAAKM,WAAWwD,IAAIxF,KAAK8B;oCACnC6B,aAAa3B,WAAWsD;oCACxB3B,aAAa3B,WAAWkD;oCACxBvB,aAAa3B,WAAWwD;oCAExBd,WAAWhD,KAAKI;oCAChB0C,gBAAgB9C,KAAKI;oCAGrBP,OAAOH;mCACR;;;;;gBAOnB,IAAIqE,eAAe,SAAUC,QAAQ5D;oBAEjC,IAAIJ,MAAMgE,OAAO;oBAGjB,IAAIhE,IAAIiE,UAAU;wBACdjE,IAAIE,MAAMC,UAAUF;wBAEpB,IAAKD,IAAIkE,iBAAiB,MAAMlE,IAAImE,aAAa,mBAAoBnE,IAAIoE,gBAAgB,KAAKpE,IAAIqE,iBAAiB,GAAG;4BAClHjB,UAAUpD,KAAKI,MAAMO,SAASP;;wBAGlCC,gBAAgBqD,KAAK1D,IAAI1B;wBACzB;;oBAIJgC,WAAWpC,OAAO4D,YAAa1B,MAAMM;oBAErCJ,WAAWpC,KAAK6D,MAAM0B,SAAS;wBAE3BvB,cAAclC,KAAKI;wBAGnBA,MAAMK,YAAYL,MAAMK,UAAU6D,SAASlE,MAAMK,YAAYL,MAAMM;wBACnEJ,WAAWsD,QAAQ9B,YAAa1B,MAAMK;wBAEtCH,WAAWsD,MAAM7B,MAAM0B,SAAS;4BAE5BjB,cAAcxC,KAAKI;4BAGnB,IAAImE,gBAAgB5F,SAAS;gCACzBsE,OAAOjD,KAAKM,WAAWsD,MAAMtF,KAAK8B;gCAClC6B,aAAa3B,WAAWpC;gCAExByE,gBAAgB3C,KAAKI;gCACrByC,UAAU7C,KAAKI;+BAChBA,MAAMQ,aAAa,IAAIR,MAAMQ,aAAa,IAAI;4BAEjD0C,YAAYvD,MAAMzB,KAAK8B,OAAOE,YAAYiE;;wBAG9CjE,WAAWsD,MAAM7B,MAAM8B,UAAU;4BAC7BrB,cAAcxC,KAAKI;4BAEnB,IAAImE,gBAAgB5F,SAAS;gCACzBsD,aAAa3B,WAAWpC;gCAExByE,gBAAgB3C,KAAKI;gCACrByC,UAAU7C,KAAKI;+BAChB;4BAEHkD,YAAYvD,MAAMzB,KAAK8B,OAAOE,YAAYiE;;wBAG9C5F,SAAS;4BACLsE,OAAOjD,KAAKM,WAAWpC,KAAKI,KAAK8B;2BAClC;;;gBASXN,GAAG0E,SAAS;gBACZxE,IAAIE,MAAMC,UAAU;gBAGpB,KAAKH,IAAI1B,KAAK;oBACV0B,IAAI1B,MAAM8B,MAAMM;;gBAGpBV,IAAIyD,SAAS;oBACTzD,IAAIE,MAAMC,UAAUF;oBAEpBJ,OAAOJ;;gBAGXO,IAAI6D,UAAU;oBACV7D,IAAIE,MAAMC,UAAUF;oBAEpBmD,UAAUpD,KAAKI,MAAMO,SAASP;oBAG9BP,OAAOH;;gBAMXf,SAAS;oBAEL,IAAI0B,gBAAgBoE,QAAQzE,IAAI1B,UAAU,GAAG;wBACzCyF,aAAajE,IAAIM;;mBAGtB,GAAG;gBAGNP,OAAO6E,OAAO,kBAAkB,SAASC,SAASC;oBAE9C,IAAID,YAAYC,WAAWvE,gBAAgBoE,QAAQzE,IAAI1B,UAAU,GAAG;wBAChE8B,MAAMK,YAAYkE;wBAClBZ,aAAajE,IAAIM;;;;;;EA3YzC,CAkZGyE,OAAOhH","file":"ng-antimoderate.js","sourcesContent":["(function(angular){\n    'use strict';\n\n    // Load module ng-antimoderate\n    var module = angular.module('ngAntimoderate', []);\n\n    module.provider('$ngAntimoderate', [ function $ngAntimoderateProvider() {\n\n        var default_src = {\n            load: 'data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==',\n            error: undefined\n        };\n\n        this.src = default_src;\n\n        this.$get = [ function() {\n            var src = this.src;\n\n            return {\n                getSrc: function () {\n                    return src;\n                }\n            };\n        }];\n\n        this.setSrc = function(src) {\n            this.src.load = src.load || default_src.load;\n            this.src.error = src.error || default_src.error;\n        };\n\n    }]);\n\n    module.directive('ngAntimoderate', [ '$timeout', '$window', '$ngAntimoderate', function ($timeout, $window, $ngAntimoderate) {\n\n        return {\n            restrict: \"A\",\n            scope: {\n                ngAntimoderate: \"@\",\n                loadSrc: \"@\",\n                loadDelay: \"@\",\n                errSrc: \"@\",\n                filter: \"@\",\n                transition: \"@\",\n                loadingClass: \"@\",\n                loadedClass: \"@\",\n                overflow: \"@\",\n                onSuccess: \"&\",\n                onError: \"&\"\n            },\n            transclude: false,\n            link: function($scope, el, attrs) {\n\n                var src = $ngAntimoderate.getSrc();\n\n                var img = el[0];\n                var img_display = img.style.display;\n                var param = {};\n                var temp_loaded_src = [];\n                var temp_image = {};\n                var image_load = src.load;\n                var image_err = src.error;\n\n                param.micro_src = $scope.ngAntimoderate || \"\";\n                param.load_src = $scope.loadSrc || image_load;\n                param.err_src = $scope.errSrc || image_err || image_load;\n                param.load_delay = parseInt($scope.loadDelay) || 300; //0 for disable, value ms\n                param.filter = angular.isDefined($scope.filter) ? $scope.filter : \"blur(20px)\";\n                param.transition = angular.isDefined($scope.transition) ? $scope.transition : \"filter 300ms\";\n                param.loading_class = angular.isDefined($scope.loadingClass) ? $scope.loadingClass : \"loading\";\n                param.loaded_class = angular.isDefined($scope.loadedClass) ? $scope.loadedClass : \"loaded\";\n                param.overflow = angular.isDefined($scope.overflow) ? $scope.overflow : true;\n\n\n\n                /**\n                 * Convert css timing to milisecond number\n                 * @param s\n                 * @returns {number}\n                 */\n                function toMS(s) {\n                    return parseFloat(s) * (/\\ds$/.test(s)? 1000 : 1);\n                }\n\n                /**\n                 * Wrap Element\n                 *\n                 * @param toWrap\n                 * @param wrapper\n                 * @returns {Node}\n                 */\n                function wrap (toWrap, wrapper) {\n\n                    wrapper = wrapper || document.createElement('div');\n                    toWrap.parentNode.insertBefore(wrapper, toWrap.nextSibling);\n                    wrapper.appendChild(toWrap);\n\n                    return wrapper;\n                }\n\n                /**\n                 * Create a image\n                 *\n                 * @param temp\n                 * @param src_name\n                 * @param src\n                 * @constructor\n                 */\n                function createImage ( src ) {\n                    var img = {\n                        image: new Image(),\n                        src: src\n                    };\n\n                    img.image.src = src;\n\n                    return img;\n                }\n\n                /**\n                 * Destroy a image\n                 *\n                 * @param temp\n                 * @param src_name\n                 */\n                function destroyImage ( image ) {\n\n                    image = null;\n\n                    return image;\n                }\n\n\n\n                function addTransition (img, param) {\n\n                    if (param.transition && param.overflow) {\n                        var wrapper_img = wrap(img);\n                        wrapper_img.classList.add('antimoderate-overflow');\n                        wrapper_img.style.width = '100%';\n                        wrapper_img.style.height = '100%';\n                        wrapper_img.style.overflow = \"hidden\";\n                    }\n\n                    return img;\n                }\n\n                function addStyleMicro (img, param) {\n\n                    if (param.load_delay > 0) {\n                        img.style.opacity = 0;\n                        img.style.transition = \"opacity \" + param.load_delay + 'ms';\n                    }\n\n                    img.classList.remove(param.loaded_class);\n                    img.classList.add(param.loading_class);\n\n                    return img;\n                }\n\n                function applyStyleMicro (img, param) {\n\n                    if (param.load_delay > 0) {\n                        img.style.transition = \"opacity \" + param.load_delay + 'ms';\n                        img.style.opacity = 1;\n\n                        $timeout(function () {\n                            img.style.opacity = '';\n                        }, toMS(img.style.transitionDuration) );\n                    }\n\n                    return img;\n                }\n\n                function addFilter (img, param) {\n\n                    if (param.filter) {\n                        img.style.filter = param.filter;\n                    }\n\n                    return img;\n                }\n\n                function applyTransition (img, param) {\n\n                    if (param.transition) {\n                        img.style.transition = param.transition;\n                    }\n\n                    if (param.filter) {\n                        img.style.filter = \"none \";\n                    }\n\n                    $timeout(function () {\n\n                        if (param.filter) {\n                            img.style.filter = \"\";\n                        }\n\n                        if (param.transition) {\n                            if (param.overflow) {\n                                img.parentElement.style.overflow = \"\";\n                            }\n\n                            img.style.transition = \"\";\n                        }\n                    }, toMS(img.style.transitionDuration) );\n\n                    return img;\n                }\n\n                function applyClass (img, param) {\n\n                    img.classList.remove(param.loading_class);\n                    img.classList.add(param.loaded_class);\n\n                    return img;\n                }\n\n                function setImg (img, src, param) {\n\n                    img.src = src;\n\n                    if (angular.isDefined($window.objectFitImages) && angular.isFunction($window.objectFitImages)) {\n                        objectFitImages('img.antimoderate');\n                    }\n\n                    return img;\n                }\n\n\n                function setImgErr (img, src, param) {\n\n                    img.srcset = src;\n\n                    return setImg(img, src, param);\n                }\n\n                function setOriginal( src, param, temp_image, promise) {\n                    //Create Original image\n                    temp_image.original = createImage( src );\n\n                    temp_image.original.image.onload = function() {\n\n                        temp_loaded_src.push(img.src);\n\n                        //Replace by original after promise micro\n                        promise.then(function () {\n\n                            $timeout(function () {\n                                setImg(img, temp_image.original.src, param);\n                                destroyImage(temp_image.micro);\n                                destroyImage(temp_image.original);\n\n                                applyClass(img, param);\n                                applyTransition(img, param);\n\n                                //Directive Result Success\n                                $scope.onSuccess();\n                            }, 0);\n                        });\n                    };\n\n                    temp_image.original.image.onerror = function() {\n\n                        temp_image.err = createImage( param.err_src );\n\n                        temp_image.err.image.onload = function() {\n\n                            //Replace by original after timeout micro\n                            promise.then(function () {\n\n                                $timeout(function () {\n                                    setImgErr(img, temp_image.err.src, param);\n                                    destroyImage(temp_image.micro);\n                                    destroyImage(temp_image.original);\n                                    destroyImage(temp_image.err);\n\n                                    applyClass(img, param);\n                                    applyTransition(img, param);\n\n                                    //Directive Result Error\n                                    $scope.onError();\n                                }, 0);\n                            });\n                        };\n                    };\n                }\n\n\n                var processImage = function (img_el, param) {\n\n                    var img = img_el[0];\n\n                    //If cached image not process image.\n                    if (img.complete) {\n                        img.style.display = img_display;\n\n                        if ((img.naturalWidth === 0 && !img.getAttribute('data-ofi-src')) || img.clientWidth === 0 || img.clientHeight === 0) {\n                            setImgErr(img, param.err_src, param);\n                        }\n\n                        temp_loaded_src.push(img.src);\n                        return;\n                    }\n\n                    //Create micro image\n                    temp_image.load = createImage( param.load_src );\n\n                    temp_image.load.image.onload = function() {\n\n                        addTransition(img, param);\n\n                        //Create micro image\n                        param.micro_src = param.micro_src.length ? param.micro_src : param.load_src;\n                        temp_image.micro = createImage( param.micro_src );\n\n                        temp_image.micro.image.onload = function() {\n\n                            addStyleMicro(img, param);\n\n                            //Add Timeout animation load source to micro source\n                            var micro_timeout = $timeout(function () {\n                                setImg(img, temp_image.micro.src, param);\n                                destroyImage(temp_image.load);\n\n                                applyStyleMicro(img, param);\n                                addFilter(img, param);\n                            }, param.load_delay > 0 ? param.load_delay / 2 : 0 );\n\n                            setOriginal(attrs.src, param, temp_image, micro_timeout);\n                        };\n\n                        temp_image.micro.image.onerror = function() {\n                            addStyleMicro(img, param);\n\n                            var micro_timeout = $timeout(function () {\n                                destroyImage(temp_image.load);\n\n                                applyStyleMicro(img, param);\n                                addFilter(img, param);\n                            }, 0);\n\n                            setOriginal(attrs.src, param, temp_image, micro_timeout);\n                        };\n\n                        $timeout(function () {\n                            setImg(img, temp_image.load.src, param);\n                        }, 0);\n                    };\n                };\n\n\n\n\n\n                //Set not display before load\n                el.addClass(\"antimoderate\");\n                img.style.display = 'none';\n\n                //Check image source if set by ng-src\n                if (!img.src) {\n                    img.src = param.load_src;\n                }\n\n                img.onload = function() {\n                    img.style.display = img_display;\n                    //Directive Result Success\n                    $scope.onSuccess();\n                };\n\n                img.onerror = function() {\n                    img.style.display = img_display;\n\n                    setImgErr(img, param.err_src, param);\n\n                    //Directive Result Error\n                    $scope.onError();\n                };\n\n\n\n                //After scope apply run process antimoderate\n                $timeout(function () {\n\n                    if (temp_loaded_src.indexOf(img.src) === -1) {\n                        processImage(el, param);\n                    }\n\n                }, 0, false);\n\n\n                $scope.$watch(\"ngAntimoderate\", function(new_val, old_val) {\n\n                    if (new_val !== old_val && temp_loaded_src.indexOf(img.src) === -1) {\n                        param.micro_src = new_val;\n                        processImage(el, param);\n                    }\n                });\n            }\n        };\n    }]);\n\n})(window.angular);\n"],"sourceRoot":"dist"}