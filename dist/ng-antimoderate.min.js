!function(i){"use strict";i.module("ngAntimoderate",[]).directive("ngAntimoderate",["$timeout",function(n){return{restrict:"A",replace:!1,scope:{ngAntimoderate:"@",loadSrc:"@",loadTransitionDelay:"@",filter:"@",transition:"@",loadingClass:"@",loadedClass:"@",overflow:"@"},transclude:!1,link:function(o,t,e){function a(i){return parseFloat(i)*(/\ds$/.test(i)?1e3:1)}function r(i){var n={image:new Image,src:i};return n.image.src=i,n}function l(i,n){return n.transition&&n.overflow&&(i.parentElement.style.overflow="hidden"),i}function s(i,n){return n.load_delay>0&&(i.style.opacity=0,i.style.transition="opacity "+n.load_delay+"ms"),i.classList.remove(n.loaded_class),i.classList.add(n.loading_class),i}function c(i,o){return o.load_delay>0&&(i.style.transition="opacity "+o.load_delay+"ms",i.style.opacity=1,n(function(){i.style.opacity=""},a(i.style.transitionDuration))),i}function d(i,n){return n.filter&&(i.style.filter=n.filter),i}function f(i,o){return o.transition&&(i.style.transition=o.transition),o.filter&&(i.style.filter="none "),n(function(){o.filter&&(i.style.filter=""),o.transition&&(o.overflow&&(i.parentElement.style.overflow=""),i.style.transition="")},a(i.style.transitionDuration)),i}function u(n,o,t){return n.src=o,i.isDefined(objectFitImages)&&i.isFunction(objectFitImages)&&objectFitImages("img.antimoderate"),n}var m=t[0],A={},g=[],y={};A.micro_src=o.ngAntimoderate||"",A.load_src=o.loadSrc||"data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==",A.load_delay=parseInt(o.loadDelay)||300,A.filter=i.isDefined(o.filter)?o.filter:"blur(20px)",A.transition=i.isDefined(o.transition)?o.transition:"filter 300ms",A.loading_class=i.isDefined(o.loadingClass)?o.loadingClass:"loading",A.loaded_class=i.isDefined(o.loadedClass)?o.loadedClass:"loaded",A.overflow=!i.isDefined(o.overflow)||o.overflow;var _=function(i,o){var t=i[0];y.load=r(o.load_src),y.load.image.onload=function(){l(t,o),o.micro_src=o.micro_src.length?o.micro_src:o.load_src,y.micro=r(o.micro_src),y.micro.image.onload=function(){s(t,o);var a=n(function(){u(t,y.micro.src),y.load,c(t,o),d(t,o)},o.load_delay>0?o.load_delay/2:0);y.original=r(e.src),y.original.image.onload=function(){g.push(t.src),a.then(function(){i.removeClass(o.loading_class),i.addClass(o.loaded_class),n(function(){u(t,y.original.src),y.micro,y.original,f(t,o)},0)})},y.original.image.onerror=function(){f(t,o)}},y.micro.image.onerror=function(){c(t,o)},n(function(){u(t,y.load.src)},0)}};t.addClass("antimoderate"),-1===g.indexOf(m.src)&&_(t,A),o.$watch("ngAntimoderate",function(i,n){i!==n&&-1===g.indexOf(m.src)&&(A.micro_src=i,_(t,A))})}}}])}(window.angular);