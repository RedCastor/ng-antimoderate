!function(b){"use strict";var r=b.module("ngAntimoderate",[]);r.provider("$ngAntimoderate",[function(){var t={load:"data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==",error:void 0};this.src=t,this.$get=[function(){var r=this.src;return{getSrc:function(){return r}}}],this.setSrc=function(r){this.src.load=r.load||t.load,this.src.error=r.error||t.error}}]),r.directive("ngAntimoderate",["$timeout","$window","$ngAntimoderate",function(S,C,E){return{restrict:"A",scope:{ngAntimoderate:"@",loadSrc:"@",loadDelay:"@",errSrc:"@",filter:"@",transition:"@",loadingClass:"@",loadedClass:"@",overflow:"@",onSuccess:"&",onError:"&"},transclude:!1,link:function(e,n,i){var r=E.getSrc(),o=n[0],a=o.style.display,s={},l=[],c={},t=r.load,d=r.error;function f(r){return parseFloat(r)*(/\ds$/.test(r)?1e3:1)}function u(r){var t={image:new Image,src:r};return t.image.src=r,t}function m(r,t){if(t.transition&&t.overflow){var n=(i=r,e=e||document.createElement("div"),i.parentNode.insertBefore(e,i.nextSibling),e.appendChild(i),e);n.classList.add("antimoderate-overflow"),n.style.width="100%",n.style.height="100%",n.style.overflow="hidden"}var i,e;return r}function g(r,t){return 0<t.load_delay&&(r.style.opacity=0,r.style.transition="opacity "+t.load_delay+"ms"),r.classList.remove(t.loaded_class),r.classList.add(t.loading_class),r}function y(r,t){return 0<t.load_delay&&(r.style.transition="opacity "+t.load_delay+"ms",r.style.opacity=1,S(function(){r.style.opacity=""},f(r.style.transitionDuration))),r}function A(r,t){return t.filter&&(r.style.filter=t.filter),r}function v(r,t){return t.transition&&(r.style.transition=t.transition),t.filter&&(r.style.filter="none "),S(function(){t.filter&&(r.style.filter=""),t.transition&&(t.overflow&&(r.parentElement.style.overflow=""),r.style.transition="")},f(r.style.transitionDuration)),r}function _(r,t){return r.classList.remove(t.loading_class),r.classList.add(t.loaded_class),r}function p(r,t,n){return r.src=t,b.isDefined(C.objectFitImages)&&b.isFunction(C.objectFitImages)&&objectFitImages("img.antimoderate"),r}function h(r,t,n){return r.srcset=t,p(r,t)}function w(r,t,n,i){n.original=u(r),n.original.image.onload=function(){l.push(o.src),i.then(function(){S(function(){p(o,n.original.src),n.micro,n.original,_(o,t),v(o,t),e.onSuccess()},0)})},n.original.image.onerror=function(){n.err=u(t.err_src),n.err.image.onload=function(){i.then(function(){S(function(){h(o,n.err.src),n.micro,n.original,n.err,_(o,t),v(o,t),e.onError()},0)})}}}s.micro_src=e.ngAntimoderate||"",s.load_src=e.loadSrc||t,s.err_src=e.errSrc||d||t,s.load_delay=parseInt(e.loadDelay)||300,s.filter=b.isDefined(e.filter)?e.filter:"blur(20px)",s.transition=b.isDefined(e.transition)?e.transition:"filter 300ms",s.loading_class=b.isDefined(e.loadingClass)?e.loadingClass:"loading",s.loaded_class=b.isDefined(e.loadedClass)?e.loadedClass:"loaded",s.overflow=!b.isDefined(e.overflow)||e.overflow;var D=function(r,t){var n=r[0];if(n.complete)return n.style.display=a,(0===n.naturalWidth&&!n.getAttribute("data-ofi-src")||0===n.clientWidth||0===n.clientHeight)&&h(n,t.err_src),void l.push(n.src);c.load=u(t.load_src),c.load.image.onload=function(){m(n,t),t.micro_src=t.micro_src.length?t.micro_src:t.load_src,c.micro=u(t.micro_src),c.micro.image.onload=function(){g(n,t);var r=S(function(){p(n,c.micro.src),c.load,y(n,t),A(n,t)},0<t.load_delay?t.load_delay/2:0);w(i.src,t,c,r)},c.micro.image.onerror=function(){g(n,t);var r=S(function(){c.load,y(n,t),A(n,t)},0);w(i.src,t,c,r)},S(function(){p(n,c.load.src)},0)}};n.addClass("antimoderate"),o.style.display="none",o.src||(o.src=s.load_src),o.onload=function(){o.style.display=a,e.onSuccess()},o.onerror=function(){o.style.display=a,h(o,s.err_src),e.onError()},S(function(){-1===l.indexOf(o.src)&&D(n,s)},0,!1),e.$watch("ngAntimoderate",function(r,t){r!==t&&-1===l.indexOf(o.src)&&(s.micro_src=r,D(n,s))})}}}])}(window.angular);