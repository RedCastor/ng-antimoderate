!function(n){"use strict";n.module("ngAntimoderate",[]).directive("ngAntimoderate",["$timeout","$window",function(i,r){return{restrict:"A",replace:!1,scope:{ngAntimoderate:"@",loadSrc:"@",loadDelay:"@",errSrc:"@",filter:"@",transition:"@",loadingClass:"@",loadedClass:"@",overflow:"@",onSuccess:"&?",onError:"&?"},transclude:!1,link:function(o,e,t){function a(n){return parseFloat(n)*(/\ds$/.test(n)?1e3:1)}function l(n,i){return i=i||document.createElement("div"),n.parentNode.appendChild(i),i.appendChild(n),i}function s(n){var i={image:new Image,src:n};return i.image.src=n,i}function c(n){return null}function d(n,i){if(i.transition&&i.overflow){var r=l(n);r.classList.add("antimoderate-overflow"),r.style.width="100%",r.style.height="100%",r.style.overflow="hidden"}return n}function f(n,i){return i.load_delay>0&&(n.style.opacity=0,n.style.transition="opacity "+i.load_delay+"ms"),n.classList.remove(i.loaded_class),n.classList.add(i.loading_class),n}function u(n,r){return r.load_delay>0&&(n.style.transition="opacity "+r.load_delay+"ms",n.style.opacity=1,i(function(){n.style.opacity=""},a(n.style.transitionDuration))),n}function m(n,i){return i.filter&&(n.style.filter=i.filter),n}function g(n,r){return r.transition&&(n.style.transition=r.transition),r.filter&&(n.style.filter="none "),i(function(){r.filter&&(n.style.filter=""),r.transition&&(r.overflow&&(n.parentElement.style.overflow=""),n.style.transition="")},a(n.style.transitionDuration)),n}function A(n,i){return n.classList.remove(i.loading_class),n.classList.add(i.loaded_class),n}function y(i,o,e){return i.src=o,n.isDefined(r.objectFitImages)&&n.isFunction(r.objectFitImages)&&objectFitImages("img.antimoderate"),i}function _(n,r,e,t){e.original=s(n),e.original.image.onload=function(){p.push(v.src),t.then(function(){i(function(){y(v,e.original.src,r),c(e.micro),c(e.original),A(v,r),g(v,r),o.onSuccess()},0)})},e.original.image.onerror=function(){e.err=s(r.err_src),e.err.image.onload=function(){t.then(function(){i(function(){y(v,e.err.src,r),c(e.micro),c(e.original),c(e.err),A(v,r),g(v,r),o.onError()},0)})}}}var v=e[0],w={},p=[],h={},C="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==";w.micro_src=o.ngAntimoderate||"",w.load_src=o.loadSrc||C,w.err_src=o.errSrc||C,w.load_delay=parseInt(o.loadDelay)||300,w.filter=n.isDefined(o.filter)?o.filter:"blur(20px)",w.transition=n.isDefined(o.transition)?o.transition:"filter 300ms",w.loading_class=n.isDefined(o.loadingClass)?o.loadingClass:"loading",w.loaded_class=n.isDefined(o.loadedClass)?o.loadedClass:"loaded",w.overflow=!n.isDefined(o.overflow)||o.overflow;var D=function(n,r){var o=n[0];h.load=s(r.load_src),h.load.image.onload=function(){d(o,r),r.micro_src=r.micro_src.length?r.micro_src:r.load_src,h.micro=s(r.micro_src),h.micro.image.onload=function(){f(o,r);var n=i(function(){y(o,h.micro.src,r),c(h.load),u(o,r),m(o,r)},r.load_delay>0?r.load_delay/2:0);_(t.src,r,h,n)},h.micro.image.onerror=function(){f(o,r);var n=i(function(){c(h.load),u(o,r),m(o,r)},0);_(t.src,r,h,n)},i(function(){y(o,h.load.src,r)},0)}};e.addClass("antimoderate"),-1===p.indexOf(v.src)&&D(e,w),o.$watch("ngAntimoderate",function(n,i){n!==i&&-1===p.indexOf(v.src)&&(w.micro_src=n,D(e,w))})}}}])}(window.angular);