!function(r){"use strict";var n=r.module("ngAntimoderate",[]);n.provider("$ngAntimoderate",[function(){var r={load:"data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==",error:void 0};this.src=r,this.$get=[function(){var r=this.src;return{getSrc:function(){return r}}}],this.setSrc=function(n){this.src.load=n.load||r.load,this.src.error=n.error||r.error}}]),n.directive("ngAntimoderate",["$timeout","$window","$ngAntimoderate",function(n,o,i){return{restrict:"A",scope:{ngAntimoderate:"@",loadSrc:"@",loadDelay:"@",errSrc:"@",filter:"@",transition:"@",loadingClass:"@",loadedClass:"@",overflow:"@",onSuccess:"&",onError:"&"},transclude:!1,link:function(t,e,a){var s=i.getSrc(),l=e[0],c={},d=[],f={},u=s.load,m=s.error;function g(r){return parseFloat(r)*(/\ds$/.test(r)?1e3:1)}function A(r){var n={image:new Image,src:r};return n.image.src=r,n}function y(r){return null,null}function v(r,n){if(n.transition&&n.overflow){var o=(i=r,t=t||document.createElement("div"),i.parentNode.insertBefore(t,i.nextSibling),t.appendChild(i),t);o.classList.add("antimoderate-overflow"),o.style.width="100%",o.style.height="100%",o.style.overflow="hidden"}var i,t;return r}function _(r,n){return n.load_delay>0&&(r.style.opacity=0,r.style.transition="opacity "+n.load_delay+"ms"),r.classList.remove(n.loaded_class),r.classList.add(n.loading_class),r}function h(r,o){return o.load_delay>0&&(r.style.transition="opacity "+o.load_delay+"ms",r.style.opacity=1,n(function(){r.style.opacity=""},g(r.style.transitionDuration))),r}function w(r,n){return n.filter&&(r.style.filter=n.filter),r}function p(r,o){return o.transition&&(r.style.transition=o.transition),o.filter&&(r.style.filter="none "),n(function(){o.filter&&(r.style.filter=""),o.transition&&(o.overflow&&(r.parentElement.style.overflow=""),r.style.transition="")},g(r.style.transitionDuration)),r}function D(r,n){return r.classList.remove(n.loading_class),r.classList.add(n.loaded_class),r}function S(n,i,t){return n.src=i,r.isDefined(o.objectFitImages)&&r.isFunction(o.objectFitImages)&&objectFitImages("img.antimoderate"),n}function C(r,o,i,e){i.original=A(r),i.original.image.onload=function(){d.push(l.src),e.then(function(){n(function(){S(l,i.original.src),y(i.micro),y(i.original),D(l,o),p(l,o),t.onSuccess()},0)})},i.original.image.onerror=function(){i.err=A(o.err_src),i.err.image.onload=function(){e.then(function(){n(function(){S(l,i.err.src),y(i.micro),y(i.original),y(i.err),D(l,o),p(l,o),t.onError()},0)})}}}c.micro_src=t.ngAntimoderate||"",c.load_src=t.loadSrc||u,c.err_src=t.errSrc||m||u,c.load_delay=parseInt(t.loadDelay)||300,c.filter=r.isDefined(t.filter)?t.filter:"blur(20px)",c.transition=r.isDefined(t.transition)?t.transition:"filter 300ms",c.loading_class=r.isDefined(t.loadingClass)?t.loadingClass:"loading",c.loaded_class=r.isDefined(t.loadedClass)?t.loadedClass:"loaded",c.overflow=!r.isDefined(t.overflow)||t.overflow;var E=function(r,o){var i=r[0];i.complete?d.push(i.src):(f.load=A(o.load_src),f.load.image.onload=function(){v(i,o),o.micro_src=o.micro_src.length?o.micro_src:o.load_src,f.micro=A(o.micro_src),f.micro.image.onload=function(){_(i,o);var r=n(function(){S(i,f.micro.src),y(f.load),h(i,o),w(i,o)},o.load_delay>0?o.load_delay/2:0);C(a.src,o,f,r)},f.micro.image.onerror=function(){_(i,o);var r=n(function(){y(f.load),h(i,o),w(i,o)},0);C(a.src,o,f,r)},n(function(){S(i,f.load.src)},0)})};l.src||(l.src=c.load_src),l.onload=function(){t.onSuccess()},l.onerror=function(){S(l,c.err_src),t.onError()},n(function(){e.addClass("antimoderate"),-1===d.indexOf(l.src)&&E(e,c)},0,!1),t.$watch("ngAntimoderate",function(r,n){r!==n&&-1===d.indexOf(l.src)&&(c.micro_src=r,E(e,c))})}}}])}(window.angular);