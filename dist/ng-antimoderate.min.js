!function(i){"use strict";i.module("ngAntimoderate",[]).directive("ngAntimoderate",["$timeout",function(n){return{restrict:"A",replace:!1,scope:{ngAntimoderate:"@",loadSrc:"@",loadTransitionDelay:"@",filter:"@",transition:"@",loadingClass:"@",loadedClass:"@",overflow:"@"},transclude:!1,link:function(t,e,o){function a(i){return parseFloat(i)*(/\ds$/.test(i)?1e3:1)}function r(i,n){return n=n||document.createElement("div"),i.parentNode.appendChild(n),n.appendChild(i),n}function l(i){var n={image:new Image,src:i};return n.image.src=i,n}function s(i,n){if(n.transition&&n.overflow){var t=r(i);t.classList.add("antimoderate-overflow"),t.style.width="100%",t.style.height="100%",i.parentElement.style.overflow="hidden"}return i}function d(i,n){return n.load_delay>0&&(i.style.opacity=0,i.style.transition="opacity "+n.load_delay+"ms"),i.classList.remove(n.loaded_class),i.classList.add(n.loading_class),i}function c(i,t){return t.load_delay>0&&(i.style.transition="opacity "+t.load_delay+"ms",i.style.opacity=1,n(function(){i.style.opacity=""},a(i.style.transitionDuration))),i}function f(i,n){return n.filter&&(i.style.filter=n.filter),i}function u(i,t){return t.transition&&(i.style.transition=t.transition),t.filter&&(i.style.filter="none "),n(function(){t.filter&&(i.style.filter=""),t.transition&&(t.overflow&&(i.parentElement.style.overflow=""),i.style.transition="")},a(i.style.transitionDuration)),i}function m(n,t,e){return n.src=t,i.isDefined(objectFitImages)&&i.isFunction(objectFitImages)&&objectFitImages("img.antimoderate"),n}var g=e[0],A={},y=[],_={};A.micro_src=t.ngAntimoderate||"",A.load_src=t.loadSrc||"data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==",A.load_delay=parseInt(t.loadDelay)||300,A.filter=i.isDefined(t.filter)?t.filter:"blur(20px)",A.transition=i.isDefined(t.transition)?t.transition:"filter 300ms",A.loading_class=i.isDefined(t.loadingClass)?t.loadingClass:"loading",A.loaded_class=i.isDefined(t.loadedClass)?t.loadedClass:"loaded",A.overflow=!i.isDefined(t.overflow)||t.overflow;var v=function(i,t){var e=i[0];_.load=l(t.load_src),_.load.image.onload=function(){s(e,t),t.micro_src=t.micro_src.length?t.micro_src:t.load_src,_.micro=l(t.micro_src),_.micro.image.onload=function(){d(e,t);var a=n(function(){m(e,_.micro.src),_.load,c(e,t),f(e,t)},t.load_delay>0?t.load_delay/2:0);_.original=l(o.src),_.original.image.onload=function(){y.push(e.src),a.then(function(){i.removeClass(t.loading_class),i.addClass(t.loaded_class),n(function(){m(e,_.original.src),_.micro,_.original,u(e,t)},0)})},_.original.image.onerror=function(){u(e,t)}},_.micro.image.onerror=function(){c(e,t)},n(function(){m(e,_.load.src)},0)}};e.addClass("antimoderate"),-1===y.indexOf(g.src)&&v(e,A),t.$watch("ngAntimoderate",function(i,n){i!==n&&-1===y.indexOf(g.src)&&(A.micro_src=i,v(e,A))})}}}])}(window.angular);