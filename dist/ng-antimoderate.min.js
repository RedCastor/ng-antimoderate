!function(n){"use strict";n.module("ngAntimoderate",[]).directive("ngAntimoderate",["$timeout","$window",function(i,t){return{restrict:"A",replace:!1,scope:{ngAntimoderate:"@",loadSrc:"@",loadTransitionDelay:"@",errSrc:"@",filter:"@",transition:"@",loadingClass:"@",loadedClass:"@",overflow:"@"},transclude:!1,link:function(e,r,o){function a(n){return parseFloat(n)*(/\ds$/.test(n)?1e3:1)}function l(n,i){return i=i||document.createElement("div"),n.parentNode.appendChild(i),i.appendChild(n),i}function s(n){var i={image:new Image,src:n};return i.image.src=n,i}function c(n){return null}function d(n,i){if(i.transition&&i.overflow){var t=l(n);t.classList.add("antimoderate-overflow"),t.style.width="100%",t.style.height="100%",t.style.overflow="hidden"}return n}function f(n,i){return i.load_delay>0&&(n.style.opacity=0,n.style.transition="opacity "+i.load_delay+"ms"),n.classList.remove(i.loaded_class),n.classList.add(i.loading_class),n}function u(n,t){return t.load_delay>0&&(n.style.transition="opacity "+t.load_delay+"ms",n.style.opacity=1,i(function(){n.style.opacity=""},a(n.style.transitionDuration))),n}function m(n,i){return i.filter&&(n.style.filter=i.filter),n}function g(n,t){return t.transition&&(n.style.transition=t.transition),t.filter&&(n.style.filter="none "),i(function(){t.filter&&(n.style.filter=""),t.transition&&(t.overflow&&(n.parentElement.style.overflow=""),n.style.transition="")},a(n.style.transitionDuration)),n}function A(n,i){return n.classList.remove(i.loading_class),n.classList.add(i.loaded_class),n}function y(i,e,r){return i.src=e,n.isDefined(t.objectFitImages)&&n.isFunction(t.objectFitImages)&&objectFitImages("img.antimoderate"),i}function _(n,t,e,r){e.original=s(n),e.original.image.onload=function(){p.push(v.src),r.then(function(){i(function(){y(v,e.original.src,t),c(e.micro),c(e.original),A(v,t),g(v,t)},0)})},e.original.image.onerror=function(){e.err=s(t.err_src),e.err.image.onload=function(){r.then(function(){i(function(){y(v,e.err.src,t),c(e.micro),c(e.original),c(e.err),A(v,t),g(v,t)},0)})}}}var v=r[0],w={},p=[],h={},C="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==";w.micro_src=e.ngAntimoderate||"",w.load_src=e.loadSrc||C,w.err_src=e.errSrc||C,w.load_delay=parseInt(e.loadDelay)||300,w.filter=n.isDefined(e.filter)?e.filter:"blur(20px)",w.transition=n.isDefined(e.transition)?e.transition:"filter 300ms",w.loading_class=n.isDefined(e.loadingClass)?e.loadingClass:"loading",w.loaded_class=n.isDefined(e.loadedClass)?e.loadedClass:"loaded",w.overflow=!n.isDefined(e.overflow)||e.overflow;var D=function(n,t){var e=n[0];h.load=s(t.load_src),h.load.image.onload=function(){d(e,t),t.micro_src=t.micro_src.length?t.micro_src:t.load_src,h.micro=s(t.micro_src),h.micro.image.onload=function(){f(e,t);var n=i(function(){y(e,h.micro.src,t),c(h.load),u(e,t),m(e,t)},t.load_delay>0?t.load_delay/2:0);_(o.src,t,h,n)},h.micro.image.onerror=function(){f(e,t);var n=i(function(){c(h.load),u(e,t),m(e,t)},0);_(o.src,t,h,n)},i(function(){y(e,h.load.src,t)},0)}};r.addClass("antimoderate"),-1===p.indexOf(v.src)&&D(r,w),e.$watch("ngAntimoderate",function(n,i){n!==i&&-1===p.indexOf(v.src)&&(w.micro_src=n,D(r,w))})}}}])}(window.angular);