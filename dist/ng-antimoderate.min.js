!function(r){"use strict";var n=r.module("ngAntimoderate",[]);n.provider("$ngAntimoderate",[function(){var r={load:"data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==",error:void 0};this.src=r,this.$get=[function(){var r=this.src;return{getSrc:function(){return r}}}],this.setSrc=function(n){this.src.load=n.load||r.load,this.src.error=n.error||r.error}}]),n.directive("ngAntimoderate",["$timeout","$window","$ngAntimoderate",function(n,i,o){return{restrict:"A",scope:{ngAntimoderate:"@",loadSrc:"@",loadDelay:"@",errSrc:"@",filter:"@",transition:"@",loadingClass:"@",loadedClass:"@",overflow:"@",onSuccess:"&",onError:"&"},transclude:!1,link:function(t,e,a){var s=o.getSrc(),l=e[0],c={},d=[],f={},u=s.load,m=s.error;function g(r){return parseFloat(r)*(/\ds$/.test(r)?1e3:1)}function A(r){var n={image:new Image,src:r};return n.image.src=r,n}function y(r){return null,null}function v(r,n){if(n.transition&&n.overflow){var i=(o=r,t=t||document.createElement("div"),o.parentNode.insertBefore(t,o.nextSibling),t.appendChild(o),t);i.classList.add("antimoderate-overflow"),i.style.width="100%",i.style.height="100%",i.style.overflow="hidden"}var o,t;return r}function _(r,n){return n.load_delay>0&&(r.style.opacity=0,r.style.transition="opacity "+n.load_delay+"ms"),r.classList.remove(n.loaded_class),r.classList.add(n.loading_class),r}function h(r,i){return i.load_delay>0&&(r.style.transition="opacity "+i.load_delay+"ms",r.style.opacity=1,n(function(){r.style.opacity=""},g(r.style.transitionDuration))),r}function w(r,n){return n.filter&&(r.style.filter=n.filter),r}function p(r,i){return i.transition&&(r.style.transition=i.transition),i.filter&&(r.style.filter="none "),n(function(){i.filter&&(r.style.filter=""),i.transition&&(i.overflow&&(r.parentElement.style.overflow=""),r.style.transition="")},g(r.style.transitionDuration)),r}function D(r,n){return r.classList.remove(n.loading_class),r.classList.add(n.loaded_class),r}function C(n,o,t){return n.src=o,r.isDefined(i.objectFitImages)&&r.isFunction(i.objectFitImages)&&objectFitImages("img.antimoderate"),n}function S(r,i,o,e){o.original=A(r),o.original.image.onload=function(){d.push(l.src),e.then(function(){n(function(){C(l,o.original.src),y(o.micro),y(o.original),D(l,i),p(l,i),t.onSuccess()},0)})},o.original.image.onerror=function(){o.err=A(i.err_src),o.err.image.onload=function(){e.then(function(){n(function(){C(l,o.err.src),y(o.micro),y(o.original),y(o.err),D(l,i),p(l,i),t.onError()},0)})}}}c.micro_src=t.ngAntimoderate||"",c.load_src=t.loadSrc||u,c.err_src=t.errSrc||m||u,c.load_delay=parseInt(t.loadDelay)||300,c.filter=r.isDefined(t.filter)?t.filter:"blur(20px)",c.transition=r.isDefined(t.transition)?t.transition:"filter 300ms",c.loading_class=r.isDefined(t.loadingClass)?t.loadingClass:"loading",c.loaded_class=r.isDefined(t.loadedClass)?t.loadedClass:"loaded",c.overflow=!r.isDefined(t.overflow)||t.overflow;var E=function(r,i){var o=r[0];o.complete?d.push(o.src):(f.load=A(i.load_src),f.load.image.onload=function(){v(o,i),i.micro_src=i.micro_src.length?i.micro_src:i.load_src,f.micro=A(i.micro_src),f.micro.image.onload=function(){_(o,i);var r=n(function(){C(o,f.micro.src),y(f.load),h(o,i),w(o,i)},i.load_delay>0?i.load_delay/2:0);S(a.src,i,f,r)},f.micro.image.onerror=function(){_(o,i);var r=n(function(){y(f.load),h(o,i),w(o,i)},0);S(a.src,i,f,r)},n(function(){C(o,f.load.src)},0)})};n(function(){e.addClass("antimoderate"),-1===d.indexOf(l.src)&&E(e,c)},0,!1),t.$watch("ngAntimoderate",function(r,n){r!==n&&-1===d.indexOf(l.src)&&(c.micro_src=r,E(e,c))})}}}])}(window.angular);