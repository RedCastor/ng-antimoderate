!function(n){"use strict";n.module("ngAntimoderate",[]).directive("ngAntimoderate",["$timeout",function(i){return{restrict:"A",replace:!1,scope:{ngAntimoderate:"@",loadSrc:"@",loadTransitionDelay:"@",filter:"@",transition:"@",loadingClass:"@",loadedClass:"@",overflow:"@"},transclude:!1,link:function(e,t,o){function a(n){return parseFloat(n)*(/\ds$/.test(n)?1e3:1)}function r(n,i){return i=i||document.createElement("div"),n.parentNode.appendChild(i),i.appendChild(n)}function l(n){var i={image:new Image,src:n};return i.image.src=n,i}function s(n,i){return i.transition&&i.overflow&&("DIV"!==n.parentElement.nodeName&&r(n),n.parentElement.style.overflow="hidden"),n}function d(n,i){return i.load_delay>0&&(n.style.opacity=0,n.style.transition="opacity "+i.load_delay+"ms"),n.classList.remove(i.loaded_class),n.classList.add(i.loading_class),n}function c(n,e){return e.load_delay>0&&(n.style.transition="opacity "+e.load_delay+"ms",n.style.opacity=1,i(function(){n.style.opacity=""},a(n.style.transitionDuration))),n}function f(n,i){return i.filter&&(n.style.filter=i.filter),n}function u(n,e){return e.transition&&(n.style.transition=e.transition),e.filter&&(n.style.filter="none "),i(function(){e.filter&&(n.style.filter=""),e.transition&&(e.overflow&&(n.parentElement.style.overflow=""),n.style.transition="")},a(n.style.transitionDuration)),n}function m(i,e,t){return i.src=e,n.isDefined(objectFitImages)&&n.isFunction(objectFitImages)&&objectFitImages("img.antimoderate"),i}var A=t[0],g={},y=[],_={};g.micro_src=e.ngAntimoderate||"",g.load_src=e.loadSrc||"data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==",g.load_delay=parseInt(e.loadDelay)||300,g.filter=n.isDefined(e.filter)?e.filter:"blur(20px)",g.transition=n.isDefined(e.transition)?e.transition:"filter 300ms",g.loading_class=n.isDefined(e.loadingClass)?e.loadingClass:"loading",g.loaded_class=n.isDefined(e.loadedClass)?e.loadedClass:"loaded",g.overflow=!n.isDefined(e.overflow)||e.overflow;var p=function(n,e){var t=n[0];_.load=l(e.load_src),_.load.image.onload=function(){s(t,e),e.micro_src=e.micro_src.length?e.micro_src:e.load_src,_.micro=l(e.micro_src),_.micro.image.onload=function(){d(t,e);var a=i(function(){m(t,_.micro.src),_.load,c(t,e),f(t,e)},e.load_delay>0?e.load_delay/2:0);_.original=l(o.src),_.original.image.onload=function(){y.push(t.src),a.then(function(){n.removeClass(e.loading_class),n.addClass(e.loaded_class),i(function(){m(t,_.original.src),_.micro,_.original,u(t,e)},0)})},_.original.image.onerror=function(){u(t,e)}},_.micro.image.onerror=function(){c(t,e)},i(function(){m(t,_.load.src)},0)}};t.addClass("antimoderate"),-1===y.indexOf(A.src)&&p(t,g),e.$watch("ngAntimoderate",function(n,i){n!==i&&-1===y.indexOf(A.src)&&(g.micro_src=n,p(t,g))})}}}])}(window.angular);