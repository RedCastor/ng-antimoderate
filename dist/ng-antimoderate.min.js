!function(n){"use strict";n.module("ngAntimoderate",[]).directive("ngAntimoderate",["$timeout",function(e){return{restrict:"A",replace:!1,scope:{ngAntimoderate:"@",loadSrc:"@",loadTransitionDelay:"@",filter:"@",transition:"@",loadingClass:"@",loadedClass:"@",overflow:"@"},transclude:!1,link:function(i,t,o){function a(n){return parseFloat(n)*(/\ds$/.test(n)?1e3:1)}function r(n,e){return e=e||document.createElement("div"),n.parentNode.appendChild(e),e.appendChild(n)}function l(n){var e={image:new Image,src:n};return e.image.src=n,e}function s(n,e){return e.transition&&e.overflow&&(console.log(n.parentElement.nodeName),"DIV"!==n.parentElement.nodeName&&r(n),n.parentElement.style.overflow="hidden"),n}function d(n,e){return e.load_delay>0&&(n.style.opacity=0,n.style.transition="opacity "+e.load_delay+"ms"),n.classList.remove(e.loaded_class),n.classList.add(e.loading_class),n}function c(n,i){return i.load_delay>0&&(n.style.transition="opacity "+i.load_delay+"ms",n.style.opacity=1,e(function(){n.style.opacity=""},a(n.style.transitionDuration))),n}function f(n,e){return e.filter&&(n.style.filter=e.filter),n}function m(n,i){return i.transition&&(n.style.transition=i.transition),i.filter&&(n.style.filter="none "),e(function(){i.filter&&(n.style.filter=""),i.transition&&(i.overflow&&(n.parentElement.style.overflow=""),n.style.transition="")},a(n.style.transitionDuration)),n}function u(e,i,t){return e.src=i,n.isDefined(objectFitImages)&&n.isFunction(objectFitImages)&&objectFitImages("img.antimoderate"),e}var g=t[0],A={},y=[],_={};A.micro_src=i.ngAntimoderate||"",A.load_src=i.loadSrc||"data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==",A.load_delay=parseInt(i.loadDelay)||300,A.filter=n.isDefined(i.filter)?i.filter:"blur(20px)",A.transition=n.isDefined(i.transition)?i.transition:"filter 300ms",A.loading_class=n.isDefined(i.loadingClass)?i.loadingClass:"loading",A.loaded_class=n.isDefined(i.loadedClass)?i.loadedClass:"loaded",A.overflow=!n.isDefined(i.overflow)||i.overflow;var p=function(n,i){var t=n[0];_.load=l(i.load_src),_.load.image.onload=function(){s(t,i),i.micro_src=i.micro_src.length?i.micro_src:i.load_src,_.micro=l(i.micro_src),_.micro.image.onload=function(){d(t,i);var a=e(function(){u(t,_.micro.src),_.load,c(t,i),f(t,i)},i.load_delay>0?i.load_delay/2:0);_.original=l(o.src),_.original.image.onload=function(){y.push(t.src),a.then(function(){n.removeClass(i.loading_class),n.addClass(i.loaded_class),e(function(){u(t,_.original.src),_.micro,_.original,m(t,i)},0)})},_.original.image.onerror=function(){m(t,i)}},_.micro.image.onerror=function(){c(t,i)},e(function(){u(t,_.load.src)},0)}};t.addClass("antimoderate"),-1===y.indexOf(g.src)&&p(t,A),i.$watch("ngAntimoderate",function(n,e){n!==e&&-1===y.indexOf(g.src)&&(A.micro_src=n,p(t,A))})}}}])}(window.angular);