!function(r){"use strict";var n=r.module("ngAntimoderate",[]);n.provider("$ngAntimoderate",[function(){var r={load:"data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==",error:void 0};this.src=r,this.$get=[function(){var r=this.src;return{getSrc:function(){return r}}}],this.setSrc=function(n){this.src.load=n.load||r.load,this.src.error=n.error||r.error}}]),n.directive("ngAntimoderate",["$timeout","$window","$ngAntimoderate",function(n,i,o){return{restrict:"A",replace:!1,scope:{ngAntimoderate:"@",loadSrc:"@",loadDelay:"@",errSrc:"@",filter:"@",transition:"@",loadingClass:"@",loadedClass:"@",overflow:"@",onSuccess:"&",onError:"&"},transclude:!1,link:function(t,e,a){function s(r){return parseFloat(r)*(/\ds$/.test(r)?1e3:1)}function l(r){var n={image:new Image,src:r};return n.image.src=r,n}function c(r,n){return n.load_delay>0&&(r.style.opacity=0,r.style.transition="opacity "+n.load_delay+"ms"),r.classList.remove(n.loaded_class),r.classList.add(n.loading_class),r}function d(r,i){return i.load_delay>0&&(r.style.transition="opacity "+i.load_delay+"ms",r.style.opacity=1,n(function(){r.style.opacity=""},s(r.style.transitionDuration))),r}function f(r,n){return n.filter&&(r.style.filter=n.filter),r}function u(r,i){return i.transition&&(r.style.transition=i.transition),i.filter&&(r.style.filter="none "),n(function(){i.filter&&(r.style.filter=""),i.transition&&(i.overflow&&(r.parentElement.style.overflow=""),r.style.transition="")},s(r.style.transitionDuration)),r}function m(r,n){return r.classList.remove(n.loading_class),r.classList.add(n.loaded_class),r}function g(n,o,t){return n.src=o,r.isDefined(i.objectFitImages)&&r.isFunction(i.objectFitImages)&&objectFitImages("img.antimoderate"),n}function A(r,i,o,e){o.original=l(r),o.original.image.onload=function(){h.push(v.src),e.then(function(){n(function(){g(v,o.original.src),o.micro,o.original,m(v,i),u(v,i),t.onSuccess()},0)})},o.original.image.onerror=function(){o.err=l(i.err_src),o.err.image.onload=function(){e.then(function(){n(function(){g(v,o.err.src),o.micro,o.original,o.err,m(v,i),u(v,i),t.onError()},0)})}}}var y=o.getSrc(),v=e[0],_={},h=[],p={},w=y.load,C=y.error;_.micro_src=t.ngAntimoderate||"",_.load_src=t.loadSrc||w,_.err_src=t.errSrc||C||w,_.load_delay=parseInt(t.loadDelay)||300,_.filter=r.isDefined(t.filter)?t.filter:"blur(20px)",_.transition=r.isDefined(t.transition)?t.transition:"filter 300ms",_.loading_class=r.isDefined(t.loadingClass)?t.loadingClass:"loading",_.loaded_class=r.isDefined(t.loadedClass)?t.loadedClass:"loaded",_.overflow=!r.isDefined(t.overflow)||t.overflow;var D=function(r,i){var o=r[0];p.load=l(i.load_src),p.load.image.onload=function(){!function(r,n){if(n.transition&&n.overflow){var i=function(r,n){return n=n||document.createElement("div"),r.parentNode.appendChild(n),n.appendChild(r),n}(r);i.classList.add("antimoderate-overflow"),i.style.width="100%",i.style.height="100%",i.style.overflow="hidden"}}(o,i),i.micro_src=i.micro_src.length?i.micro_src:i.load_src,p.micro=l(i.micro_src),p.micro.image.onload=function(){c(o,i);var r=n(function(){g(o,p.micro.src),p.load,d(o,i),f(o,i)},i.load_delay>0?i.load_delay/2:0);A(a.src,i,p,r)},p.micro.image.onerror=function(){c(o,i);var r=n(function(){p.load,d(o,i),f(o,i)},0);A(a.src,i,p,r)},n(function(){g(o,p.load.src)},0)}};e.addClass("antimoderate"),-1===h.indexOf(v.src)&&D(e,_),t.$watch("ngAntimoderate",function(r,n){r!==n&&-1===h.indexOf(v.src)&&(_.micro_src=r,D(e,_))})}}}])}(window.angular);